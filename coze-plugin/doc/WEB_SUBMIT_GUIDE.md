# Web é¡µé¢æäº¤è‰ç¨¿ - ä½¿ç”¨æŒ‡å—

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

é€šè¿‡ URL æäº¤è‰ç¨¿æ•°æ®å,ç³»ç»Ÿä¼šè‡ªåŠ¨é‡å®šå‘åˆ°ä¸€ä¸ªç²¾ç¾çš„ Web é¡µé¢,å®æ—¶å±•ç¤ºä»»åŠ¡çŠ¶æ€å’Œè¿›åº¦,æ— éœ€æ‰‹åŠ¨è½®è¯¢ APIã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- **è‡ªåŠ¨é‡å®šå‘**: æäº¤åè‡ªåŠ¨è·³è½¬åˆ°çŠ¶æ€é¡µé¢
- **å®æ—¶åˆ·æ–°**: æ¯ 2 ç§’è‡ªåŠ¨æ›´æ–°ä»»åŠ¡çŠ¶æ€
- **è¿›åº¦å¯è§†åŒ–**: ç¾è§‚çš„è¿›åº¦æ¡å’Œæ•°æ®å±•ç¤º
- **çŠ¶æ€æç¤º**: æ¸…æ™°çš„æˆåŠŸ/å¤±è´¥æç¤º
- **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨ç«¯æµè§ˆå™¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³• 1: æµè§ˆå™¨ç›´æ¥è®¿é—®

1. **å¯åŠ¨åç«¯æœåŠ¡**
   ```bash
   cd pyJianYingDraftServer
   python run.py
   ```

2. **å‡†å¤‡ JSON æ•°æ®URL**
   - ç¡®ä¿ä½ çš„ JSON æ•°æ®å¯ä»¥é€šè¿‡ HTTP/HTTPS è®¿é—®
   - æ•°æ®æ ¼å¼å‚è€ƒä¸‹æ–‡"JSON æ•°æ®æ ¼å¼"

3. **åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€**
   ```
   http://127.0.0.1:8000/api/tasks/submit_with_url?url=YOUR_JSON_URL
   ```

4. **è‡ªåŠ¨è·³è½¬åˆ°çŠ¶æ€é¡µé¢**
   - é¡µé¢ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°ä»»åŠ¡çŠ¶æ€å±•ç¤ºé¡µé¢
   - å®æ—¶æ˜¾ç¤ºä»»åŠ¡è¿›åº¦

### æ–¹æ³• 2: ä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
cd coze-plugin
python test_web_submit.py
```

è¿™ä¸ªè„šæœ¬ä¼š:
1. âœ… åˆ›å»ºæµ‹è¯• JSON æ•°æ®
2. âœ… å¯åŠ¨æœ¬åœ° HTTP æœåŠ¡å™¨
3. âœ… è‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æäº¤ URL
4. âœ… å±•ç¤ºå®æ—¶ä»»åŠ¡çŠ¶æ€é¡µé¢

### æ–¹æ³• 3: cURL å‘½ä»¤

```bash
# POST è¯·æ±‚
curl -X POST "http://127.0.0.1:8000/api/tasks/submit_with_url?url=YOUR_JSON_URL"

# GET è¯·æ±‚ (ä¹Ÿæ”¯æŒ)
curl "http://127.0.0.1:8000/api/tasks/submit_with_url?url=YOUR_JSON_URL"
```

## ğŸ“± Web çŠ¶æ€é¡µé¢åŠŸèƒ½

### é¡µé¢å…ƒç´ 

1. **ä»»åŠ¡ä¿¡æ¯å¡ç‰‡**
   - ä»»åŠ¡ ID
   - å½“å‰çŠ¶æ€(ç­‰å¾…ä¸­/ä¸‹è½½ä¸­/å¤„ç†ä¸­/å·²å®Œæˆ/å¤±è´¥)
   - çŠ¶æ€æ¶ˆæ¯
   - åˆ›å»ºæ—¶é—´å’Œæ›´æ–°æ—¶é—´

2. **ä¸‹è½½è¿›åº¦åŒºåŸŸ** (ä¸‹è½½ä¸­æ—¶æ˜¾ç¤º)
   - å¯è§†åŒ–è¿›åº¦æ¡
   - å·²å®Œæˆ/æ€»æ–‡ä»¶æ•°
   - å·²ä¸‹è½½å¤§å°
   - ä¸‹è½½é€Ÿåº¦
   - é¢„è®¡å‰©ä½™æ—¶é—´

3. **æ“ä½œæŒ‰é’®**
   - ğŸ”„ ç«‹å³åˆ·æ–°: æ‰‹åŠ¨åˆ·æ–°çŠ¶æ€
   - âŒ å–æ¶ˆä»»åŠ¡: å–æ¶ˆæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡

4. **è‡ªåŠ¨åˆ·æ–°æŒ‡ç¤ºå™¨**
   - æ˜¾ç¤ºæœ€åæ›´æ–°æ—¶é—´
   - è‡ªåŠ¨åˆ·æ–°åŠ¨ç”»æç¤º

### çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | é¢œè‰² | è¯´æ˜ |
|------|------|------|
| **ç­‰å¾…ä¸­** | é»„è‰² | ä»»åŠ¡å·²æäº¤,ç­‰å¾…å¤„ç† |
| **ä¸‹è½½ä¸­** | è“è‰² | æ­£åœ¨ä¸‹è½½è¿œç¨‹ç´ æ |
| **å¤„ç†ä¸­** | é’è‰² | æ­£åœ¨ç”Ÿæˆè‰ç¨¿æ–‡ä»¶ |
| **å·²å®Œæˆ** | ç»¿è‰² | ä»»åŠ¡å®Œæˆ,æ˜¾ç¤ºè‰ç¨¿è·¯å¾„ |
| **å¤±è´¥** | çº¢è‰² | ä»»åŠ¡å¤±è´¥,æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ |
| **å·²å–æ¶ˆ** | ç°è‰² | ä»»åŠ¡è¢«ç”¨æˆ·å–æ¶ˆ |

## ğŸ¨ é¡µé¢è®¾è®¡ç‰¹ç‚¹

### è§†è§‰è®¾è®¡
- **æ¸å˜èƒŒæ™¯**: ç´«è‰²æ¸å˜èƒŒæ™¯,ç°ä»£åŒ–è§†è§‰æ•ˆæœ
- **å¡ç‰‡å¸ƒå±€**: ç™½è‰²å¡ç‰‡,æ¸…æ™°å±‚æ¬¡æ„Ÿ
- **åœ†è§’è®¾è®¡**: æŸ”å’Œçš„åœ†è§’,å‹å¥½çš„è§†è§‰ä½“éªŒ
- **çŠ¶æ€å¾½ç« **: å½©è‰²çŠ¶æ€æ ‡ç­¾,ä¸€ç›®äº†ç„¶

### äº¤äº’è®¾è®¡
- **åŠ è½½åŠ¨ç”»**: æ—‹è½¬å›¾æ ‡è¡¨ç¤ºæ­£åœ¨å¤„ç†
- **å¹³æ»‘è¿‡æ¸¡**: è¿›åº¦æ¡å˜åŒ–æµç•…è‡ªç„¶
- **å®æ—¶æ›´æ–°**: æ•°æ®å˜åŒ–å³æ—¶åæ˜ 
- **å“åº”å¼**: è‡ªåŠ¨é€‚é…ä¸åŒå±å¹•å°ºå¯¸

### ç”¨æˆ·ä½“éªŒ
- **è‡ªåŠ¨åˆ·æ–°**: æ— éœ€æ‰‹åŠ¨åˆ·æ–°é¡µé¢
- **å®Œæˆæç¤º**: æˆåŠŸ/å¤±è´¥æ¸…æ™°æç¤º
- **æ“ä½œå¼•å¯¼**: æ˜ç¡®çš„æ“ä½œæŒ‰é’®
- **é”™è¯¯å¤„ç†**: å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

## ğŸ“Š æ•°æ®æµç¨‹

```
1. ç”¨æˆ·æäº¤ URL
   â†“
2. åç«¯éªŒè¯å¹¶åˆ›å»ºä»»åŠ¡
   â†“
3. é‡å®šå‘åˆ°çŠ¶æ€é¡µé¢ (/static/task_status.html?task_id=xxx)
   â†“
4. JavaScript å¼€å§‹è½®è¯¢ /api/tasks/{task_id}
   â†“
5. æ¯ 2 ç§’æ›´æ–°ä¸€æ¬¡é¡µé¢æ•°æ®
   â†“
6. ä»»åŠ¡å®Œæˆååœæ­¢è½®è¯¢,æ˜¾ç¤ºç»“æœ
```

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### å‰ç«¯æŠ€æœ¯
- **çº¯ HTML/CSS/JavaScript**: æ— éœ€ä»»ä½•æ¡†æ¶
- **Fetch API**: å¼‚æ­¥è·å–æ•°æ®
- **URLSearchParams**: è§£æä»»åŠ¡ ID
- **setInterval**: å®ç°å®šæ—¶åˆ·æ–°

### åç«¯æŠ€æœ¯
- **FastAPI**: Web æ¡†æ¶
- **RedirectResponse**: è‡ªåŠ¨é‡å®šå‘
- **StaticFiles**: é™æ€æ–‡ä»¶æœåŠ¡
- **Queryå‚æ•°**: æ¥æ”¶ URL å‚æ•°

### æ–‡ä»¶ç»“æ„
```
pyJianYingDraftServer/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ static/
â”‚   â”‚   â””â”€â”€ task_status.html     # ä»»åŠ¡çŠ¶æ€é¡µé¢
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â””â”€â”€ tasks.py              # API è·¯ç”±
â”‚   â””â”€â”€ main.py                   # é™æ€æ–‡ä»¶é…ç½®
```

## ğŸ“ JSON æ•°æ®æ ¼å¼

è¿œç¨‹ URL è¿”å›çš„ JSON å¿…é¡»åŒ…å«ä»¥ä¸‹å­—æ®µ:

```json
{
  "ruleGroup": {
    "id": "group_123",
    "title": "æˆ‘çš„è‰ç¨¿"
  },
  "materials": [
    {
      "id": "mat_1",
      "type": "video",
      "path": "https://example.com/video.mp4"
    }
  ],
  "testData": {
    "tracks": [],
    "items": []
  },
  "draft_config": {
    "canvas_width": 1920,
    "canvas_height": 1080,
    "fps": 30
  }
}
```

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: é¡µé¢æ˜¾ç¤º "ä»»åŠ¡ä¸å­˜åœ¨"
**åŸå› **: ä»»åŠ¡ ID æ— æ•ˆæˆ–ä»»åŠ¡å·²è¢«åˆ é™¤
**è§£å†³**: æ£€æŸ¥ URL ä¸­çš„ `task_id` å‚æ•°æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 2: é¡µé¢ä¸€ç›´æ˜¾ç¤º "åŠ è½½ä¸­"
**åŸå› **: æ— æ³•è¿æ¥åˆ°åç«¯ API
**è§£å†³**:
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å·²å¯åŠ¨
2. æ£€æŸ¥åç«¯åœ°å€æ˜¯å¦ä¸º `http://127.0.0.1:8000`
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 3: æäº¤åæ˜¾ç¤º 404 é”™è¯¯
**åŸå› **: é™æ€æ–‡ä»¶ç›®å½•æœªæ­£ç¡®é…ç½®
**è§£å†³**:
1. ç¡®è®¤ `pyJianYingDraftServer/app/static/` ç›®å½•å­˜åœ¨
2. ç¡®è®¤ `task_status.html` æ–‡ä»¶å­˜åœ¨
3. é‡å¯åç«¯æœåŠ¡

### é—®é¢˜ 4: è¿›åº¦æ¡ä¸æ›´æ–°
**åŸå› **: JavaScript è‡ªåŠ¨åˆ·æ–°å¤±è´¥
**è§£å†³**:
1. æ‰‹åŠ¨ç‚¹å‡»"ç«‹å³åˆ·æ–°"æŒ‰é’®
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
3. ç¡®è®¤ `/api/tasks/{task_id}` æ¥å£å¯è®¿é—®

## ğŸ’¡ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰åˆ·æ–°é—´éš”

ä¿®æ”¹ `task_status.html` ä¸­çš„åˆ·æ–°é—´éš”(é»˜è®¤ 2000ms):

```javascript
refreshInterval = setInterval(() => {
    if (!isCompleted) {
        refreshStatus();
    }
}, 2000); // ä¿®æ”¹è¿™é‡Œçš„å€¼(æ¯«ç§’)
```

### ç¦ç”¨è‡ªåŠ¨åˆ·æ–°

åœ¨ `window.onload` ä¸­æ³¨é‡Šæ‰è‡ªåŠ¨åˆ·æ–°:

```javascript
window.onload = function() {
    if (!taskId) {
        showError('æœªæä¾›ä»»åŠ¡ ID');
        return;
    }

    document.getElementById('taskId').textContent = taskId;
    refreshStatus();
    // startAutoRefresh(); // æ³¨é‡Šè¿™ä¸€è¡Œç¦ç”¨è‡ªåŠ¨åˆ·æ–°
};
```

### è‡ªå®šä¹‰æ ·å¼

ä¿®æ”¹ `task_status.html` ä¸­çš„ CSS å˜é‡:

```css
body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    /* ä¿®æ”¹èƒŒæ™¯æ¸å˜é¢œè‰² */
}

.progress-bar {
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    /* ä¿®æ”¹è¿›åº¦æ¡é¢œè‰² */
}
```

## ğŸ“ ç›¸å…³é“¾æ¥

- **è¯¦ç»† API æ–‡æ¡£**: [README_SUBMIT_WITH_URL.md](./README_SUBMIT_WITH_URL.md)
- **å¿«é€Ÿå¼€å§‹æŒ‡å—**: [QUICK_START_URL_SUBMIT.md](./QUICK_START_URL_SUBMIT.md)
- **æºä»£ç **:
  - çŠ¶æ€é¡µé¢: [task_status.html](../pyJianYingDraftServer/app/static/task_status.html)
  - API è·¯ç”±: [tasks.py](../pyJianYingDraftServer/app/routers/tasks.py)

## ğŸ‰ ç¤ºä¾‹æˆªå›¾è¯´æ˜

### ç­‰å¾…ä¸­çŠ¶æ€
- é»„è‰²çŠ¶æ€å¾½ç« 
- åŠ è½½åŠ¨ç”»æ—‹è½¬
- æ˜¾ç¤º"ä»»åŠ¡ç­‰å¾…ä¸­"æ¶ˆæ¯

### ä¸‹è½½ä¸­çŠ¶æ€
- è“è‰²çŠ¶æ€å¾½ç« 
- æ˜¾ç¤ºè¿›åº¦æ¡
- å®æ—¶æ›´æ–°ä¸‹è½½é€Ÿåº¦å’Œå‰©ä½™æ—¶é—´

### å®ŒæˆçŠ¶æ€
- ç»¿è‰²çŠ¶æ€å¾½ç« 
- æ˜¾ç¤ºè‰ç¨¿æ–‡ä»¶è·¯å¾„
- åœæ­¢è‡ªåŠ¨åˆ·æ–°

### å¤±è´¥çŠ¶æ€
- çº¢è‰²çŠ¶æ€å¾½ç« 
- æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
- åœæ­¢è‡ªåŠ¨åˆ·æ–°

---

**æç¤º**: é¦–æ¬¡ä½¿ç”¨å»ºè®®è¿è¡Œ `test_web_submit.py` æµ‹è¯•è„šæœ¬ä½“éªŒå®Œæ•´æµç¨‹ï¼
